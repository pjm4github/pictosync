@startuml FIG1_System_Architecture
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam rectangle {
  RoundCorner 8
}
skinparam package {
  RoundCorner 6
}
skinparam arrow {
  Color #555555
  Thickness 1.5
}

title **FIG. 1 — System Architecture: Four Security Zones**

package "OT ZONE\n(NERC CIP Protected)" as OT #FFF0F0 {
  rectangle "SCADA / EMS" as scada #FFCCCC
  rectangle "Protection Relays\n(IEC 61850)" as relays #FFCCCC
  rectangle "DNP3 Outstations\n/ RTUs" as dnp3 #FFCCCC
  rectangle "Process Bus\n(GOOSE / SV)" as processbus #FFCCCC
  rectangle "OT Ring Buffer\n(Time-Series)" as otbuffer #FFE0E0
}

package "EDGE DMZ\n(Substation Compute)" as EDGE #F0F8FF {
  rectangle "Anomaly Detector\n(ONNX Classifier)" as anomaly #CCE5FF
  rectangle "Ephemeral Fusion\nEngine" as fusion #CCE5FF
  rectangle "Voice Interface\n(Whisper STT)" as voice #CCE5FF
  rectangle "Tag Store\n(Persistent Insights)" as tagstore #CCE5FF
  rectangle "Recommendation\nEngine" as recom #CCE5FF
  rectangle "Encrypted tmpfs\nWorkspace" as tmpfs #E0F0FF
  rectangle "Zero-Trust\nPolicy Engine" as policy #CCE5FF
}

package "IT ZONE\n(Enterprise Network)" as IT #F0FFF0 {
  rectangle "AMI / MDMS\n(Meter Data)" as ami #CCFFCC
  rectangle "Maximo EAM\n(Asset Mgmt)" as maximo #CCFFCC
  rectangle "Kraken CIS\n(Customer Info)" as kraken #CCFFCC
  rectangle "PI Historian\n(Operational Data)" as pihistorian #CCFFCC
  rectangle "GIS / NMS\n(Network Model)" as gis #CCFFCC
}

package "CORPORATE / CLOUD ZONE" as CORP #FFF8F0 {
  rectangle "Skill Repository\n(Git-backed, Versioned)" as repo #FFE8CC
  rectangle "Identity Provider\n(SAML / OIDC)" as idp #FFE8CC
  rectangle "Skill Quality\nAnalytics" as analytics #FFE8CC
}

' === Data Flows ===

' OT → Edge (through data diode)
processbus -[#CC0000,bold]-> anomaly : <color:#CC0000>**Hardware Data Diode**\n<color:#CC0000>(Unidirectional)
otbuffer -[#CC0000]-> fusion : OT stream\n(read-only)

' Edge internal
anomaly --> recom : anomaly\nevent
anomaly --> tagstore : pre-scan\nquery
recom --> fusion : skill\nrecommendation
voice --> fusion : SME\ncommands
fusion --> tmpfs : IT data\n(ephemeral)
fusion --> tagstore : tagged\nresult
policy --> fusion : authorization\ndecision
policy --> voice : operator\nvalidation

' Edge ↔ IT (authenticated, egress-filtered)
fusion -[#008800]-> ami : <color:#008800>connector\n<color:#008800>(short-lived token)
fusion -[#008800]-> maximo
fusion -[#008800]-> kraken
fusion -[#008800]-> pihistorian
fusion -[#008800]-> gis

' Edge ↔ Corporate
repo -[#CC6600]-> fusion : skill\npackages
idp -[#CC6600]-> policy : identity\nclaims
fusion -[#CC6600]-> analytics : outcome\nmetrics

legend right
  |= Color |= Meaning |
  | <#FFCCCC> | OT Zone (CIP-protected) |
  | <#CCE5FF> | Edge DMZ (fusion compute) |
  | <#CCFFCC> | IT Zone (enterprise data) |
  | <#FFE8CC> | Corporate/Cloud Zone |
  | <color:#CC0000>━━</color> | Unidirectional (data diode) |
  | <color:#008800>━━</color> | Authenticated + egress-filtered |
  | <color:#CC6600>━━</color> | Controlled corporate channel |
endlegend

@enduml