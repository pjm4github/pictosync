@startuml FIG5_Tagged_Result_Schema
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam class {
  BackgroundColor #F8F8FF
  BorderColor #8888BB
  ArrowColor #555555
  RoundCorner 6
}

title **FIG. 5 — Tagged Result Schema**

class "**TaggedResult**" as TR #E8E0FF {
  tag_id : str = "tag-3217"
  tagged_by : str = "e.ruiz"
  tagged_at : datetime
  schema_version : str = "tagged-result/v1"
}

class "**TriggerContext**" as TC #FFEEEE {
  anomaly_id : str
  type : str  «e.g. "waveform_distortion"»
  subtype : str  «e.g. "3rd_harmonic_surge"»
  severity : enum {low, medium, high, critical}
  confidence : float [0.0–1.0]
}

class "**AssetFingerprint**" as AF #E8FFE8 {
  id : str  «e.g. "XFMR-4A"»
  asset_class : str  «e.g. "power_transformer"»
  feeder : str  «e.g. "feeder_12"»
  substation : str  «e.g. "sub_14"»
  voltage_level : str  «e.g. "69kV/12.47kV"»
  --
  + match_score(other) : float
}

class "**SkillResult**" as SR #FFF8E0 {
  skill_id : str
  skill_version : str
  result_summary : str
  confidence : float
  execution_time_ms : int
}

class "**CompositeAnswer**" as CA #E0F0FF {
  classification : str
  root_cause : str
  confidence : float  «Bayesian composite»
  recommended_action : str
  urgency : str  «e.g. "48_hours"»
}

class "**SemanticTags**" as ST #F0E8FF {
  tags : list[str]
  --
  «Invertible index keys:»
  by_asset, by_feeder,
  by_anomaly_type,
  by_skill, by_classification,
  by_semantic_tag
}

class "**SMETranscript**" as SM #FFF0E0 {
  full_transcript : str
  notes : list[str]
  operator_reasoning : str
  --
  «Institutional knowledge —»
  «preserves WHY, not just WHAT»
}

class "**ErasureAttestation**" as EA #FFE8E8 {
  attestation_hash : str  «sha256»
  it_data_erased : bool = true
  erasure_timestamp : datetime
  worm_audit_ref : str
}

class "**DiagnosticChainLinks**" as DC #F0F0FF {
  related_tag_ids : list[str]
  chain_position : int
  chain_severity_trend : str
  --
  «Links form temporal narrative:»
  «tag-2891 → tag-3104 → tag-3217»
}

' === Relationships ===
TR *-down- TC : trigger
TR *-down- AF : asset
TR *-down- "1..*" SR : skills_applied\n(ordered)
TR *-down- CA : answer
TR *-down- ST : tags
TR *-down- SM : sme_transcript
TR *-down- EA : erasure
TR *-down- DC : related_tags

note bottom of DC
  **Diagnostic Chain Example:**
  tag-2891 (6mo ago): first harmonic observation, severity=medium
  tag-3104 (3mo ago): repeat harmonic + load correlation, severity=medium
  tag-3217 (today): incipient failure classification, severity=high
  → Escalating pattern detected
end note

note right of SR
  **Bayesian Composite Confidence:**
  composite = first_skill.confidence
  for each additional skill:
    if confidence ≥ 0.7:
      composite += (1-composite) × conf × 0.3
    else:
      composite *= (0.8 + 0.2 × conf)
end note

@enduml